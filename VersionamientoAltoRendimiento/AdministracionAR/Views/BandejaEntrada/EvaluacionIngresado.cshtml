@{
    ViewBag.Title = "EvaluacionProyecto";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@model AltoRendimiento.Administracion.Models.ProyectoModel


<div id='myModal' class='modal fade in'>
    <div class="modal-dialog">
        <div class="modal-content">
            <div id='myModalContent'></div>
        </div>
    </div>
</div>


<script src="~/Scripts/modalform.js"></script>

<script type="text/javascript">
    $(document).ready(function () {


        var adm = '@AltoRendimiento.Administracion.Util.SessionIND.Current.BandejaEntrada.admin';

        if (adm == 'False') {
            $('#Administracion').addClass("hide");
        }


        var mensaje = '@ViewData["mensaje"]';
        var tipoAlerta = '@ViewData["tipoAlterta"]';
        if (tipoAlerta == "" || tipoAlerta == null) {
            tipoAlerta = "success";
        }
        if (mensaje != "") {
            var mensajeUsuario = '<div class="alert alert-' + tipoAlerta + ' alert-dismissable"><button type="button" class="close" data-dismiss="alert">&times;</button>' + mensaje + '</div>';
            $("#mensaje").append(mensajeUsuario);
            $('#btnCambiarEstadoIngresado')
        }





        $('#btnObservarProyecto').click(function () {
            var url = '@Url.Action("CambiarEstado")';
            var model = $('form').serialize() + "&estadoIngresado=2";

            $.ajax({
                url: url,
                type: 'POST',
                data: model,
                success: function (data) {
                    console.log(data);
                    $('#myModalContent').html(data);

                    $('#myModal').modal('show');
                },
                error: function () {
                    alert("error");
                }
            });

        });

        $('#btnAceptarProyecto').click(function () {
            var url = '@Url.Action("CambiarEstado")';
            var modelAceptar = $('form').serialize() + "&estadoIngresado=3";

            $.ajax({
                url: url,
                type: 'POST',
                data: modelAceptar,
                success: function (data) {
                    console.log(data);
                    $('#myModalContent').html(data);

                    $('#myModal').modal('show');
                },
                error: function () {
                    alert("error");
                }
            });

        });
    });

    $('#myModal').on('hidden.bs.modal', function () {
        location.reload();
    })
</script>

@using (Html.BeginForm())
{
    if (Model.estadoIngresado == 2)
    {
        <div class="panel panel-info">
            <div class="panel-heading">Observaciones</div>
            <div class="form-horizontal">
                <div class="form-group">
                    <div class="col-md-12">
                        @if (ViewBag.observacionProyecto != null)
                        {
                            <label class="col-lg-12 bold"> @ViewBag.observacionProyecto</label>
                        }
                    </div>
                </div>
            </div>
        </div>
    }

    <div class="panel panel-default">
        <div class="panel-heading">Informacion Proyecto Ingresado</div>
        <br />
        <div id="mensaje">
        </div>
        <div class="form-horizontal">
            <fieldset disabled>


                <div class="form-group">
                    @Html.LabelFor(p => p.Proyecto, new { @class = "col-lg-2 control-label" })
                    <div class="col-md-8">
                        @Html.TextBoxFor(p => p.Proyecto, new { @class = "form-control", @value = Model.Proyecto })
                    </div>
                </div>
                <div class="form-group">
                    @Html.LabelFor(p => p.Codigo, new { @class = "col-lg-2 control-label" })
                    <div class="col-xs-3">
                        @Html.TextBoxFor(p => p.Codigo, new { @class = "form-control" })
                    </div>
                </div>
                <div class="form-group">
                    @Html.LabelFor(p => p.Rut, new { @class = "col-lg-2 control-label" })
                    <div class="col-xs-3">
                        @Html.TextBoxFor(p => p.Rut, new { @class = "form-control" })
                    </div>
                </div>
                <div class="form-group">
                    @Html.LabelFor(p => p.Postulante, new { @class = "col-lg-2 control-label" })
                    <div class="col-md-8">
                        @Html.TextBoxFor(p => p.Organizacion.Nombre, new { @class = "form-control" })
                    </div>
                </div>
                <div class="form-group">
                    @Html.LabelFor(p => p.TipoEntidad, new { @class = "col-lg-2 control-label" })
                    <div class="col-md-8">
                        @Html.TextBoxFor(p => p.Organizacion.TipoEntidad, new { @class = "form-control" })
                    </div>
                </div>
                <div class="form-group">
                    @Html.LabelFor(p => p.DetalleEntidad, new { @class = "col-lg-2 control-label" })
                    <div class="col-md-8">
                        @Html.TextBoxFor(p => p.Organizacion.DetalleEntidad, new { @class = "form-control" })
                    </div>
                </div>
                <div class="form-group">
                    @Html.LabelFor(p => p.CorreoElectronico, new { @class = "col-lg-2 control-label" })
                    <div class="col-md-3">
                        @Html.TextBoxFor(p => p.Organizacion.CorreoElctronico, new { @class = "form-control" })
                    </div>
                </div>
                <div class="form-group">
                    @Html.LabelFor(p => p.RegistroIND, new { @class = "col-lg-2 control-label" })
                    <div class="col-md-3">
                        @Html.TextBoxFor(p => p.Organizacion.NumeroRegistroInd, new { @class = "form-control" })
                    </div>
                </div>
                <div class="form-group">
                    @Html.LabelFor(p => p.Leyconstitucion, new { @class = "col-lg-2 control-label" })
                    <div class="col-md-8">
                        @Html.TextBoxFor(p => p.Organizacion.LeyConstitucion, new { @class = "form-control" })
                    </div>
                </div>
                <div class="form-group">
                    @Html.LabelFor(p => p.RendicionCuentaPendiente, new { @class = "col-lg-2 control-label" })
                    <div class="col-md-2">
                        @Html.TextBoxFor(p => p.Organizacion.TieneRendicionPendiente, new { @class = "form-control" })
                    </div>
                </div>
                <div class="form-group">
                    @Html.LabelFor(p => p.DirectorioVigente, new { @class = "col-lg-2 control-label" })
                    <div class="col-md-2">
                        @Html.TextBoxFor(p => p.Organizacion.TieneDirectorioVigente, new { @class = "form-control" })
                    </div>
                </div>
                @*<div class="form-group">
                        @Html.LabelFor(p => p.MontoProyecto , new { @class = "col-lg-2 control-label" })
                        <div class="col-md-3">
                            @Html.TextBox(string.Format("{0:C0}" , Model.MontoProyecto) , string.Format("{0:C0}" , Model.MontoProyecto) , new { @class = "form-control" })
                        </div>
                    </div>*@
                <div class="form-group">
                    @Html.LabelFor(p => p.FechaEvaluacion, new { @class = "col-lg-2 control-label" })
                    <div class="col-md-3">
                        @Html.TextBoxFor(p => p.FechaEvaluacion, new { @class = "form-control" })
                    </div>
                </div>


            </fieldset>
        </div>


        @Html.HiddenFor(p => p.IdWorkflow)
        @Html.HiddenFor(p => p.IdWorkflowDestino)
        @Html.HiddenFor(p => p.IdProyecto)
        @Html.HiddenFor(p => p.Vista)

        <div class="panel-body">
            @*<div class="panel-heading">Estado</div>*@
            <fieldset>
                <legend>Estado</legend>
                <div class="btn-group btn-toolbar" role="group" aria-label="...">

                    <div class="btn-group" role="group">
                        <div class="col-md-2">
                            @Html.ActionLink("Volver", "Index", null, new { @class = "btn btn-warning" })
                        </div>
                    </div>

                    @if (Model.estadoIngresado == 1)
                    {
                        <div class="btn-group" role="group">
                            <div class="col-md-2">
                                <button type="button" class="btn btn-danger" id="btnObservarProyecto" @((AltoRendimiento.Administracion.Util.SessionIND.Current.BandejaEntrada.btnCambiarEstadoIngresado == false) ? "disabled" : "") @((Model.ValidaPaso == false) ? "disabled" : "")>Observar</button>
                            </div>
                        </div>
                        <div class="btn-group" role="group">
                            <div class="col-md-2">
                                <button type="button" class="btn btn-success" id="btnAceptarProyecto" @((AltoRendimiento.Administracion.Util.SessionIND.Current.BandejaEntrada.btnCambiarEstadoIngresado == false) ? "disabled" : "") @((Model.ValidaPaso == false) ? "disabled" : "")>Aceptar Proyecto</button>
                            </div>
                        </div>
                    }
                    else
                    {
                        <div class="btn-group" role="group">
                            <div class="col-md-2">
                                <button type="button" class="btn btn-danger" id="btnObservarProyecto" disabled="disabled">Observar</button>
                            </div>
                        </div>
                        <div class="btn-group" role="group">
                            <div class="col-md-2">
                                <button type="button" class="btn btn-success" id="btnAceptarProyecto" disabled="disabled">Aceptar Proyecto</button>
                            </div>
                        </div>
                    }
                </div>
            </fieldset>

        </div>
    </div>
}