@model AltoRendimiento.Models.ArchivoSolicitudModel


@{
    ViewBag.Title = "Nuevo Archivo Solicitud";
}

<div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
    <h4 class="modal-title" id="myModalLabel">Nuevo Archivo para Solicitud de Cambio</h4>
</div>
@using (@Html.BeginForm("GuardaArchivo", "ProductoCopia", FormMethod.Post, new { enctype = "multipart/form-data", id = "fr" }))
{
    <div class="modal-body">
        <div class="form-horizontal">
            <div id="div_Mensaje" class="alert alert-info" role="alert" style="display:none">
                <label>El archivo se ha guardado con éxito.</label>
                <button type="button" class="btn btn-sm btn-sm" id="btnDireccionaEdit" onclick="redireccionaModificar()">Direccionar a Modificación</button>
            </div>
            <div id="div_Mensaje_Error" class="alert alert-info" role="alert" style="display:none">
                <label id="txtError">Ha ocurrido un problema, asegurese de ingresar todos los campos que sean requeridos.</label>
            </div>

            <div class="panel panel-default">
                <div class="panel-heading">
                    Archivo de respaldo para Solicitud de Cambio
                </div>
                <div class="panel-body">
                    <div class="form-group">
                        <label for="lblTipoArchivo" class="control-label col-md-4" style="font-size: 14px;">Tipo Archivo</label>
                        <div class="col-md-8">
                            @Html.DropDownListFor(p => p.idTipoArchivoSolicitud, (SelectList)ViewBag.TipoArchvios, "--Seleccione--", new { @class = "form-control required", @id = "idTipoArchivo" })
                            <span id="idTipoArchivoMensaje" class="field-validation-valid" data-valmsg-for="idTipoArchivo" data-valmsg-replace="true"></span>
                        </div>
                    </div>
                    @*<div class="form-group">
                        <label for="lblFecha" class="control-label col-md-4" style="font-size: 14px;">Nombre Documento</label>
                        <div class="col-md-7">
                            @Html.TextBoxFor(p => p.ascNombreArchivo, new { @class = "form-control", @id = "txtNombreArchivo" })
                            @Html.ValidationMessageFor(model => model.ascNombreArchivo)

                        </div>
                    </div>*@
                    <div class="form-group">
                        <label for="lbl" class="control-label col-md-4" style="font-size: 14px;">Seleccione Archivo</label>
                        <div class="col-md-8">
                            <input type="file" id="file" class="form-control" name="file" />
                            <span id="fileMensaje" class="field-validation-valid" data-valmsg-for="dopNombreIdentificacion" data-valmsg-replace="true"></span>
                        </div>
                    </div>
                </div>
                @Html.HiddenFor(model => model.idSolicitud)
            </div>
            <div class="panel panel-default">
                <div class="panel-heading">
                    Descripción Archivo
                </div>
                <div class="panel-body">
                    <div class="col-xs-12">
                        @Html.TextAreaFor(model => model.ascDescripcion, new { @class = "form-control", @rows = "5", @maxlength = "2047", @style = "resize:none;", @id = "txtdescripcion" })
                        <span id="txtdescripcionMensaje" class="field-validation-valid" data-valmsg-for="txtdescripcion" data-valmsg-replace="true"></span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal-footer">
        <button type="button" id="btnCancelar" class="btn btn-sm btn-danger pull-left" data-dismiss="modal">Cancelar</button>
        <button type="submit" id="submit" class="btn btn-sm btn-success">Guardar</button>
    </div>
}


<script type="text/javascript">
    $(":file").filestyle({ buttonText: "Seleccionar Archivo", buttonName: "btn-primary" });

    $('#submit').click(function () {

        var faltaInfo = false;
        if ($("#txtdescripcion").val().trim() == "") {
            $("#txtdescripcion").addClass("input-validation-error");
            $("#txtdescripcionMensaje").text("El Nombre Documento es obligatorio");
            $("#txtdescripcionMensaje").removeClass("field-validation-valid");
            $("#txtdescripcionMensaje").addClass("field-validation-error");
            faltaInfo = true;
        } else {
            $("#txtdescripcion").removeClass("input-validation-error");
            $("#txtdescripcionMensaje").text("");
            $("#txtdescripcionMensaje").removeClass("field-validation-error");
            $("#txtdescripcionMensaje").addClass("field-validation-valid");
        }

        if ($("#idTipoArchivo :selected").val().trim() == "" || $("#idTipoArchivo :selected").val().trim() == "0") {
            $("#idTipoArchivo").addClass("input-validation-error");
            $("#idTipoArchivoMensaje").text("El Tipo Documento es obligatorio");
            $("#idTipoArchivoMensaje").removeClass("field-validation-valid");
            $("#idTipoArchivoMensaje").addClass("field-validation-error");
            faltaInfo = true;
        } else {
            $("#idTipoArchivo").removeClass("input-validation-error");
            $("#idTipoArchivoMensaje").text("");
            $("#idTipoArchivoMensaje").removeClass("field-validation-error");
            $("#idTipoArchivoMensaje").addClass("field-validation-valid");
        }

        if ($("#file").val().trim() == "") {
            $("#file").addClass("input-validation-error");
            $("#fileMensaje").text("Adjuntar Archivo es obligatorio");
            $("#fileMensaje").removeClass("field-validation-valid");
            $("#fileMensaje").addClass("field-validation-error");
            faltaInfo = true;
        } else {
            $("#file").removeClass("input-validation-error");
            $("#fileMensaje").text("");
            $("#fileMensaje").removeClass("field-validation-error");
            $("#fileMensaje").addClass("field-validation-valid");

            if (('#file').files[0].size <= 26214400) {
                $("#fileMensaje").text("");
                $("#fileMensaje").removeClass("field-validation-error");
                $("#fileMensaje").addClass("field-validation-valid");
            } else {
                $("#fileMensaje").text("El tamaño del archivo a excedido el limite de 25MB.");
                $("#fileMensaje").removeClass("field-validation-valid");
                $("#fileMensaje").addClass("field-validation-error");
                faltaInfo = true;
            }
        }

        //alert($("#file").val());
        if (faltaInfo) {
            return false;
        } /*else {

            //alert("entro")
            /*e.preventDefault = true;
            var xhr = new XMLHttpRequest();
            xhr.onreadystatechange = function (e) {
                if (4 == this.readyState) {
                    console.log(['xhr upload complete', e]);
                }
            };
            xhr.open('post', '/DocumentosProyecto/Create', true);
            xhr.setRequestHeader("Content-Type", "multipart/form-data");
            var formData = new FormData();
            formData.append("Documento", document.getElementById("Documento").files);
            formData.append("dopNombreIdentificacion", $("#dopNombreIdentificacion").val())
            formData.append("idTipoDocumentoProyecto", $("#idTipoDocumentoProyecto").val())
            // etc
            xhr.send(formData);*/

        //alert($("input[type=file]").files[0].mozFullPath)
        //document.envio.Documento = document.getElementById("Documento").files;
        //$("#envio").append(document.getElementById("Documento").files)
        $("form").submit();
        //document. envio.submit();
        //}



        //$('form').submit();
    });


    $('#file').bind('change', function () {
        if (this.files[0].size <= 26214400) {
            $('#submit').removeAttr("disabled");
            $("#fileMensaje").text("");
            $("#fileMensaje").removeClass("field-validation-error");
            $("#fileMensaje").addClass("field-validation-valid");
        } else {
            $('#submit').attr("disabled", "true");
            $("#fileMensaje").text("El tamaño del archivo a excedido el limite de 25MB.");
            $("#fileMensaje").removeClass("field-validation-valid");
            $("#fileMensaje").addClass("field-validation-error");
        }
    });


    $('form').ajaxForm({
        success: function (response) {
            //alert(response.Mensaje);
            if (data.success == true) {
                //$("#div_Mensaje").show();
                //$("#idTipoArchivo").prop("disabled", true);
                ////$("#txtNombreArchivo").prop("disabled", true);
                //$("#file").prop("disabled", true);
                //$("#txtdescripcion").prop("disabled", true);
                //$("#btngrabar").prop("disabled", true);
            }
            else {
                //$("#div_Mensaje_Error").show();
            }
        },
        error: function (response) {
            //alert(response.Mensaje);
        }
        //,
        //complete: function (xhr) {
        //    alert(xhr.responseText);
        //}
    });

</script>


@*<script type="text/javascript">
        $(document).ready(function () {
            alert("entro 1");
            $('#form-SubirArchivo').validate({
                rules: {
                    idTipoArchivo: {
                        required: true
                    },
                    txtNombreArchivo: {
                        required: true
                    },
                    txtdescripcion: {
                        required: true
                    }
                },
                messages: {
                    idTipoArchivo: {
                        required: "Debe seleccionar un tipo de archivo"
                    },
                    txtNombreArchivo: {
                        required: "Debe ingresar un nombre de archivo"
                    },
                    txtdescripcion: {
                        required: "Debe ingresar una descripción"
                    }
                },
                onfocusout: function (e) {
                    this.element(e);
                },
                onkeyup: false,
                errorClass: 'text-danger'
            });

            $('#btnGrabar').click(function (e) {
                $('#form-SubirArchivo').valid();

                alert("entro 2");

                console.log(model);
            });

        });
    </script>*@
<script src="~/Scripts/jquery.validate-vsdoc.js"></script>
<script src="~/Scripts/jquery.validate.js"></script>
<script src="~/Scripts/jquery.validate.min.js"></script>
<script src="~/Scripts/jquery.validate.unobtrusive.js"></script>
<script src="~/Scripts/jquery.validate.unobtrusive.min.js"></script>
